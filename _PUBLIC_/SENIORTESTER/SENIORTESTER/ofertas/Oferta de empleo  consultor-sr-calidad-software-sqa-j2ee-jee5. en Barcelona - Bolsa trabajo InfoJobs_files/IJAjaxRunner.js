var IJAjaxRunner=function(){var ijAjax={};ijAjax.priv={};ijAjax.runner={};ijAjax.runner.getController=function(){return ijAjax.priv.controller};ijAjax.runner.getTimeout=function(){return ijAjax.priv.timeout};ijAjax.runner.setTimeout=function(timeout){ijAjax.priv.timeout=timeout};ijAjax.runner.getLoadingMessageText=function(){return ijAjax.priv.loadingMessageText};ijAjax.runner.setLoadingMessageText=function(loadingMessageText){ijAjax.priv.loadingMessageText=loadingMessageText};ijAjax.runner.initController=function(controller){this.controller=controller;for(var s in controller){var obj=controller[s];if(typeof obj=="function"){Ajaxpect.addAround(controller,s,ijAjax.priv.commonExecute)}}};ijAjax.runner.continueExpiredRequest=function(){window.parent.tb_remove();var call=ijAjax.priv.getLastSessionExpiredCall();if(call!=null){ijAjax.priv.cleanSessionsExpiredCall();call.execute()}};ijAjax.runner.setShowLoadingMessage=function(funcShowLoading){this.funcShowLoadingMessage=funcShowLoading};ijAjax.runner.setRemoveLoadingMessage=function(funcRemoveLoading){this.funcRemoveLoadingMessage=funcRemoveLoading};ijAjax.priv.internalErrorHandler=function(message,ex){entrarThickBox("","error-ajax.xhtml","400","280")};ijAjax.priv.jsErrorHandler=function(error){if(error.ex){ijAjax.priv._debug(error.ex)}else{ijAjax.priv._debug(error)}};ijAjax.priv.showLoadingMessage=function(message){document.body.style.cursor="progress";var divLoading=document.getElementById("ajax-loading");if(divLoading){document.body.removeChild(divLoading)}divLoading=document.createElement("DIV");document.body.appendChild(divLoading);divLoading.id="ajax-loading";divLoading.innerHTML="<p>"+message+"</p>";var totalWidth=document.documentElement.clientWidth;var txtWidth=divLoading.offsetWidth;var tpc=(totalWidth-txtWidth)/totalWidth/2*100;divLoading.style.left=tpc+"%";divLoading.style.display="block"};ijAjax.priv.removeLoadingMessage=function(){document.body.style.cursor="default";var obj=document.getElementById("ajax-loading");obj.style.display="none"};ijAjax.priv.addSessionExpiredCall=function(call){this.expiredSessionCalls.push(call)};ijAjax.priv.cleanSessionsExpiredCall=function(){this.expiredSessionCalls=[]};ijAjax.priv.getLastSessionExpiredCall=function(){if(this.expiredSessionCalls.length>0){return this.expiredSessionCalls[this.expiredSessionCalls.length-1]}else{return null}};ijAjax.priv.commonExecute=function(args){try{var parametros=[];var funcionOriginal=null;var lastArg=null;if(arguments.length==1){funcionOriginal=arguments[0]}else{funcionOriginal=arguments[1];if(args.length>0){var lastArg=args[args.length-1];if(args.length>1){for(var i=0;i<args.length-1;i++){parametros.push(args[i])}}}}var ijCall=new IJCall(funcionOriginal);if(parametros.length>0){ijCall.setCallArgs(parametros)}var callData;if(typeof lastArg=="function"){callData={callback:lastArg}}else{if(lastArg==null){callData={}}else{callData=lastArg}}for(var s in callData){var newobj=callData[s];if(typeof newobj=="function"){if(s=="callback"){ijCall.setCallbackFunc(newobj)}else{if(s=="errorHandler"){ijCall.setCustomErrorFunc(newobj)}else{if(s=="internalErrorHandler"){ijCall.setInternalErrorFunc(newobj)}else{if(s=="showLoadMsgFunc"){ijCall.setShowLoadMsgFunc(newobj)}else{if(s=="removeLoadMsgFunc"){ijCall.setRemoveLoadMsgFunc(newobj)}else{if(s=="jsErrorHandler"){ijCall.setJsErrorFunc(newobj)}}}}}}}else{if(s=="extraCallbackArg"){ijCall.setExtraCallbackArg(newobj)}else{if(s=="timeout"){ijCall.setTimeout(newobj)}else{if(s=="loadingText"){ijCall.setLoadingMessageText(newobj)}}}}}ijCall.execute()}catch(ex){ijAjax.priv.jsErrorHandler(ex)}};ijAjax.priv._disableAjaxActions=function(){try{var elements=document.getElementsByClassName("AjaxAction");for(var i=0;i<elements.length;i++){var elem=elements[i];elem.disabled=true}}catch(ex){ijAjax.priv.jsErrorHandler(ex)}};ijAjax.priv._enableAjaxActions=function(){try{var elements=document.getElementsByClassName("AjaxAction");for(var i=0;i<elements.length;i++){var elem=elements[i];elem.disabled=false}}catch(ex){ijAjax.priv.jsErrorHandler(ex)}};ijAjax.priv._debug=function(exception){try{DWREngine._debug("Error: "+exception);if(exception.stack){var stack=exception.stack;stack=stack.substr(0,500);DWREngine._debug("Stack: "+stack+" ...")}}catch(ex){}};ijAjax.priv.controller=null;ijAjax.priv.timeout=600000;ijAjax.priv.loadingMessageText=getIJMessage("ajax.cargandoDatos");ijAjax.priv.funcShowLoadingMessage=ijAjax.priv.showLoadingMessage;ijAjax.priv.funcRemoveLoadingMessage=ijAjax.priv.removeLoadingMessage;ijAjax.priv.expiredSessionCalls=[];var IJjsException=function(ex){this.message=ex.message;this.ex=ex;this.type=_ijConstants.jsError};var IJFilterException=function(message,ex){this.message=message;this.exception=ex;this._getType=function(){var t=_ijConstants.internalError;if(this.exception.type!="undefined"){t=this.exception.type}return t};this.isCustomError=function(){var t=this._getType();return t==_ijConstants.customError};this.isSessionError=function(){var t=this._getType();return t==_ijConstants.sessionError};this.isInternalError=function(){var t=this._getType();return !this.isCustomError()&&!this.isJSError()&&!this.isSessionError()};this.isJSError=function(){var t=this._getType();return t==_ijConstants.jsError}};var IJCall=function(originalCall){this.id=Math.random;this.originalCall=originalCall;this.callArgs=null;this.callbackFunc=null;this.customErrorFunc=null;this.internalErrorFunc=ijAjax.priv.internalErrorHandler;this.jsErrorFunc=ijAjax.priv.jsErrorHandler;this.showLoadMsgFunc=ijAjax.priv.funcShowLoadingMessage;this.removeLoadMsgFunc=ijAjax.priv.funcRemoveLoadingMessage;this.timeout=ijAjax.priv.timeout;this.loadingMessageText=ijAjax.priv.loadingMessageText;this.extraCallbackArg=null;this.setCallArgs=function(args){this.callArgs=args};this.setCallbackFunc=function(func){this.callbackFunc=func};this.setCustomErrorFunc=function(func){this.customErrorFunc=func};this.setInternalErrorFunc=function(func){this.internalErrorFunc=func};this.setJsErrorFunc=function(func){this.jsErrorFunc=func};this.setShowLoadMsgFunc=function(func){this.showLoadMsgFunc=func};this.setRemoveLoadMsgFunc=function(func){this.removeLoadMsgFunc=func};this.setTimeOut=function(func){this.timeout=func};this.setExtraCallbackArg=function(arg){this.extraCallbackArg=arg};this.setLoadingMessageText=function(arg){this.loadingMessageText=arg};this.getId=function(){return this.id};this.execute=function(){try{this.preHook();try{var callData=this.createCallback();var args=[];if(this.callArgs!=null){args=this.callArgs}args.push(callData);this.originalCall.apply(this,args)}catch(ex1){var exception=new IJjsException(ex1);this.commonErrorHandler(exception.message,exception)}}catch(ex2){var exception=new IJjsException(ex2);this.commonErrorHandler(exception.message,exception)}};this.bind=function(method,object){return function(){return method.apply(object,arguments)}};this.createCallback=function(){try{var callData={};if(this.callbackFunc===null){this.callbackFunc=this.dummyCallbackFunc}callData.callback=this.bind(this.commonCallback,this);callData.errorHandler=this.bind(this.commonErrorHandler,this);dwrHeader={};if(this.customErrorFunc==null||typeof this.customErrorFunc=="undefined"){eval("dwrHeader."+_ijConstants.headerDWRLabel+"= _ijConstants.headerNotHasCustomError")}else{eval("dwrHeader."+_ijConstants.headerDWRLabel+"= _ijConstants.headerHasCustomError")}callData.headers=dwrHeader;if(typeof this.timeout!="undefined"&&this.timeout>0){callData.timeout=this.timeout}return callData}catch(ex){var exception=new IJjsException(ex);this.commonErrorHandler(exception.message,exception)}};this.dummyCallbackFunc=function(){};this.commonCallback=function(result){try{if(typeof this.extraCallbackArg!=="undefined"&&this.extraCallbackArg!==null){this.callbackFunc(result,this.extraCallbackArg)}else{this.callbackFunc(result)}}catch(ex){var exception=new IJjsException(ex);this.commonErrorHandler(exception.message,exception)}finally{this.postHook()}};this.sessionExpired=function(message,ex){try{if(parseInt(ex.role)==parseInt(_ijConstants.SESSION_ROLE_EMPLEADO)){entrarThickBox("","/core/employer-login-ajax-edit.xhtml","400","380")}else{if(parseInt(ex.role)==parseInt(_ijConstants.SESSION_ROLE_CANDIDATO)){entrarThickBox("","/candidate-login-ajax.xhtml","400","380")}else{alert("Not implemented")}}}catch(ex){var exception=new IJjsException(ex);this.commonErrorHandler(exception.message,exception)}};this.commonErrorHandler=function(args){try{var message=arguments[0];var error=arguments[1];bHasCustomError=(this.customErrorFunc!==null&&typeof this.customErrorFunc!=="undefined");var filter=new IJFilterException(message,error);if(filter.isJSError()){this.jsErrorFunc(error)}else{if(filter.isSessionError()){ijAjax.priv.addSessionExpiredCall(this);this.sessionExpired(message,error)}else{if(filter.isCustomError()){if(bHasCustomError){this.customErrorFunc(message,error)}else{this.internalErrorFunc(message,error)}}else{this.internalErrorFunc(message,error)}}}}catch(ex){this.jsErrorFunc(ex)}finally{this.postHook()}};this.preHook=function(){try{this.showLoadMsgFunc(this.loadingMessageText)}catch(ex){this.jsErrorFunc(ex)}};this.postHook=function(){try{this.removeLoadMsgFunc()}catch(ex){this.jsErrorFunc(ex)}}};return ijAjax.runner}();